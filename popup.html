<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouTube Transcript Extractor</title>
    <link rel="stylesheet" href="popup.css" />
  </head>

  <body>
    <div class="container">
      <!-- --------------------------------------------------- -->
      <!-- Header -->
      <header>
        <h1>YouTube Transcript Extractor</h1>
        <p class="subtitle">Extract and download video transcripts</p>
      </header>

      <!-- --------------------------------------------------- -->
      <!-- Loading State -->
      <section id="loading" class="section hidden" aria-live="polite">
        <div class="spinner"></div>
        <p>Loading video information...</p>
      </section>

      <!-- --------------------------------------------------- -->
      <!-- Error State -->
      <section id="error" class="section hidden" aria-live="assertive">
        <div class="error-content">
          <p id="error-message">Something went wrong</p>
          <div class="button-group">
            <button id="retry-btn" class="btn btn-secondary">Try Again</button>
          </div>
        </div>
      </section>

      <!-- --------------------------------------------------- -->
      <!-- Video Info Section -->
      <section id="video-info" class="section hidden">
        <div class="video-details">
          <h3 id="video-title">Video Title</h3>
          <p class="video-id">ID: <span id="video-id-display">—</span></p>
        </div>

        <!-- Language Selection -->
        <div id="language-selection" class="hidden">
          <label for="language-select">Choose language:</label>
          <select id="language-select" class="form-control">
            <option value="">Select a language…</option>
          </select>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
          <button id="extract-btn" class="btn btn-primary">
            Extract Transcript
          </button>
          <button id="refresh-btn" class="btn btn-secondary">Refresh</button>
        </div>

        <!-- Info Tip -->
        <div class="info-notice" role="note">
          <p>
            <strong>Tip:</strong> Enable captions on the video player for
            automatic capture.
          </p>
        </div>

        <!-- Auto-Capture Banner -->
        <div id="transcript-captured-banner" class="captured-banner hidden">
          <div class="captured-content">
            <div class="captured-text">
              <strong>Transcript Captured</strong>
              <p>Auto-captured from video captions</p>
            </div>
            <button id="dismiss-captured" class="btn-dismiss" title="Dismiss">
              ×
            </button>
          </div>
        </div>
      </section>

      <!-- --------------------------------------------------- -->
      <!-- No Transcripts -->
      <section id="no-transcripts" class="section hidden">
        <div class="empty-state">
          <h3>Manual Transcript Extraction Failed</h3>
          <p>
            This video's transcript cannot be extracted through the API. This is
            common and expected for many videos.
          </p>

          <!-- Auto-capture guidance -->
          <div class="auto-capture-guide">
            <h4>Use Auto-Capture Method Instead:</h4>
            <div class="steps">
              <div class="step">
                <span class="step-number">1</span>
                <p>
                  Click on the <strong>CC</strong> (captions) button on the
                  YouTube video player
                </p>
              </div>
              <div class="step">
                <span class="step-number">2</span>
                <p>Choose your preferred language from the captions menu</p>
              </div>
              <div class="step">
                <span class="step-number">3</span>
                <p>
                  Let the video play for a few seconds with captions visible
                </p>
              </div>
              <div class="step">
                <span class="step-number">4</span>
                <p>
                  The transcript will be automatically captured and you'll see a
                  notification
                </p>
              </div>
            </div>

            <!-- Auto-capture status -->
            <div id="auto-capture-status" class="capture-status hidden">
              <div class="status-indicator">
                <div class="pulse-indicator"></div>
                <span id="capture-status-text">Waiting for captions...</span>
              </div>
              <p class="status-help">
                Make sure captions are enabled and visible on the video player
              </p>
            </div>
          </div>

          <div class="button-group">
            <button id="enable-auto-capture" class="btn btn-primary">
              Start Auto-Capture
            </button>
          </div>

          <div class="help-notice">
            <p>
              <strong>Note:</strong> Auto-capture is more reliable than the API
              method. It works by detecting captions as they appear on screen
              and usually succeeds even when the transcript API fails.
            </p>
          </div>
        </div>
      </section>

      <!-- --------------------------------------------------- -->
      <!-- Results Section -->
      <section id="results" class="section hidden">
        <div class="results-header">
          <h3>Transcript</h3>
          <div class="transcript-info">
            <span id="language-info" class="info-badge">English</span>
            <span id="type-info" class="info-badge">Auto-generated</span>
            <span id="word-count" class="info-badge">0 words</span>
          </div>
        </div>

        <!-- Format Toggle -->
        <div class="format-toggle">
          <label class="toggle-switch">
            <div class="toggle-switch-slider">
              <input
                type="checkbox"
                id="timestamp-toggle"
                aria-label="Include timestamps"
              />
              <span class="toggle-slider"></span>
            </div>
            <span class="toggle-label">Include timestamps</span>
          </label>
        </div>

        <!-- Transcript Display -->
        <div class="transcript-container">
          <textarea
            id="transcript-text"
            readonly
            placeholder="Transcript will appear here..."
            aria-label="Transcript text"
          ></textarea>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
          <button id="copy-btn" class="btn btn-primary">Copy</button>
          <button id="download-btn" class="btn btn-secondary">Download</button>
          <button id="extract-another" class="btn btn-secondary">
            Extract Another
          </button>
        </div>

        <!-- Success Message -->
        <div id="copy-success" class="success-message hidden" role="status">
          Copied to clipboard!
        </div>
      </section>

      <!-- --------------------------------------------------- -->
      <!-- Transcript List -->
      <section id="transcript-list" class="section hidden">
        <div class="list-header">
          <h3>Captured Transcripts</h3>
          <p class="subtitle">
            Session transcripts (cleared on browser restart)
          </p>
        </div>

        <div id="transcript-items" class="transcript-items">
          <!-- Transcripts will be populated here -->
        </div>

        <!-- Download All Options Modal -->
        <div id="download-options-modal" class="modal-overlay hidden">
          <div class="modal-content">
            <h3>Download All Transcripts</h3>
            <p id="download-count-text">Preparing to download transcripts...</p>

            <div class="form-group">
              <label for="download-format-select">Format:</label>
              <select id="download-format-select" class="form-control">
                <option value="txt">Text (.txt)</option>
                <option value="json">JSON (.json)</option>
                <option value="md">Markdown (.md)</option>
              </select>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  id="download-include-timestamps"
                  checked
                />
                <span class="checkmark"></span>
                Include timestamps
              </label>
            </div>

            <div class="modal-buttons">
              <button id="confirm-download-all" class="btn btn-primary">
                Download
              </button>
              <button id="cancel-download-all" class="btn btn-secondary">
                Cancel
              </button>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button id="refresh-list" class="btn btn-secondary">Refresh</button>
          <button id="download-all-btn" class="btn btn-primary">
            Download All
          </button>
          <button id="clear-all-transcripts" class="btn btn-secondary">
            Clear All
          </button>
        </div>
      </section>

      <!-- --------------------------------------------------- -->
      <!-- Not YouTube -->
      <section id="not-youtube" class="section hidden">
        <div class="empty-state">
          <h3>Navigate to YouTube</h3>
          <p>Please open a YouTube video page to extract transcripts.</p>
          <a
            href="https://youtube.com"
            target="_blank"
            rel="noopener"
            class="btn btn-primary"
          >
            Open YouTube
          </a>
        </div>
      </section>
    </div>

    <script src="popup.js"></script>
  </body>
</html>
